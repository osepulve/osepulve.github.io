---
layout: page
---
{{ content }}

{% if page.collection %}
  {% assign all_items = site[page.collection] %}

  {% if page.display_category %}
    {% comment %} --- MODE 1: SINGLE CATEGORY (Sorted by Date Newest to Oldest) --- {% endcomment %}
    {% assign filtered_books = all_items | where: "category", page.display_category | sort: "date" | reverse %}
    
    <div class="container">
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3">
        {% for item in filtered_books %}
          <div class="col mb-4" style="display: flex; justify-content: center;">
             {% include book_figure.liquid %}
          </div>
        {% endfor %}
      </div>
    </div>

  {% else %}
    {% comment %} --- MODE 2: FULL MAIN BOOKSHELF --- {% endcomment %}
    
    {% comment %} Sort everything by date first to ensure 'reversed' works correctly {% endcomment %}
    {% assign sorted_items = all_items | sort: "date" | reverse %}
    
    {% assign mentoring_books = sorted_items | where: "category", "Mentoring" %}
    {% assign other_books = sorted_items | where_exp: "item", "item.category != 'Mentoring'" %}

    {% comment %} Part A: Mentoring (Now following your original reversed date order) {% endcomment %}
    {% if mentoring_books.size > 0 %}
      <h2 class="category">
        <a href="{{ '/books/mentoring/' | relative_url }}" style="color: inherit; text-decoration: none;">Mentoring ðŸ”—</a>
      </h2>
      <h3 class="category-subtitle" style="font-weight: 300; margin-bottom: 1.5rem;">For current/prospective students</h3>
      <div style="display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 40px;">
        {% for item in mentoring_books %}
           {% include book_figure.liquid %}
        {% endfor %}
      </div>
      <hr>
    {% endif %}

    {% comment %} Part B: All Other Books by Year (Your original logic) {% endcomment %}
    {% assign year = "" %}
    {% for item in other_books %}
      {% assign current_year = item.date | date: '%Y' %}
      {% if current_year != year %}
        {% unless forloop.first %}</ul>{% endunless %}
        <h2 class="category" id="y{{ current_year }}">
          <a href="{{ current_year | prepend: '/books/' | relative_url }}">{{ current_year }}</a>
        </h2>
        <ul style="list-style: none; display: flex; flex-wrap: wrap; gap: 20px; padding: 0;">
        {% assign year = current_year %}
      {% endif %}
      <li>
         {% include book_figure.liquid %}
      </li>
      {% if forloop.last %}</ul>{% endif %}
    {% endfor %}
  {% endif %}
{% endif %}
